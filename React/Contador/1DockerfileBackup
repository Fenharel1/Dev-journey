FROM node:20.11.1-alpine as build

WORKDIR /usr/src/app

ENV NODE_ENV production

COPY package*.json ./

RUN npm install
#RUN npm ci --only=production
COPY . .

RUN npm run build

FROM nginx:1.22-alpine

USER node

COPY --from=build --chown=node:node usr/src/app/dist /usr/share/nginx/html

EXPOSE 3000

CMD ["npm","run","dev"]